<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Demo</title>
  <script src="jquery-2.0.3.js"></script>
  <style>
    #times {
      font-size: 72px;
    }
    #error {
      font-size: 36px;
      color: red;
    }
  </style>
</head>
<body>
  <div id="error"></div>
  <div id="times"></div>
  <script>
  function format(seconds) {
    if (seconds >= 10)
      return seconds;
    return "0" + seconds;
  }
  var success = function(e) {
    $('#error').empty();
    $('#times').empty();
    console.log(e);
    directions = $(e).find("direction[title='Inbound to Downtown']");
    predictions = directions.find('prediction');
    var num_predictions = 0;
    predictions.each(function(index, elem) {
      if (elem.attributes['affectedByLayover'] == null ||
          !elem.attributes['affectedByLayover'].value) {
        var seconds = elem.attributes['seconds'].value;
        var to_display = Math.floor(seconds / 60) + "m " + format(seconds % 60) + "s";
        $('#times').append('<div>' + to_display + '</div>');
        num_predictions++;
      }
    });
    if (num_predictions == 0) {
      console.log("nothing");
      $('#times').append('<div>nothing</div>');
    }
  }
  var error = function(e) {
    // Instead of empty/append, change to replace?
    $('#error').empty();
    $('#error').append("<div>got error: " + JSON.stringify(e) + "</div>");
  }
  var ajaxOptions = {
    // Change to stop tag + route specifier, X2
    // And change command to predictionsForMultiStops
    // "&stops=J|3996"
    url: "http://webservices.nextbus.com/service/publicXMLFeed?command=predictions&a=sf-muni&stopId=13996",
    dataType: "xml",
    success: success,
    error: error
  };
  // Change this to fetch instead of jquery.
  $.ajax(ajaxOptions);
  setInterval(function() {
      $.ajax(ajaxOptions);
  }, 10 * 1000)

  </script>
</body>
</html>
